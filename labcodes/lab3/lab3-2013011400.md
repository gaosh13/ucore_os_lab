## 练习题

---

### 练习0

将lab1修改的init.c、trap.c、kdebug.c以及lab2修改的default_pmm.c、pmm.c与lab3的相应文件采用diff命令得到补丁文件，适当修改补丁文件后再使用patch命令对lab3的文件打补丁，完成移植。

其中应注意到init.c、trap.c在lab3中的修改部分，所以需要适当修改补丁文件。

---

### 练习1

#### 设计

修改vmm.c文件，首先尝试获取页表项（get_pte函数，在LAB2中完成），若页表项中没有该项的信息，则申请一页（pgdir_alloc_page）。

#### 问题

问题与LAB2中问题相同，具体回答参考lab2-2013011400.md。

---

### 练习2

#### 设计

1. 接exercise1页表项存在的分支，如果该页存在，则一定是在磁盘中，把该页换入内存，在memory manager中添加该页信息以便将来的管理，最后标记该页可换出，设置虚拟地址。

1. 修改swap_fifo.c文件，fifo的策略为先进先出，实现非常简单（相对clock等其它算法），采用链表来维护内存中的这些页。在swappable（即添加）时直接将新的页面插入到链表的头部。

1. swap_out_victim换出页面也相对简单，需要找到链表尾部的页并删除（简单进行链表中至少包含一页的检查），然后返回ptr_page相应页的信息。

#### 在ucore上实现extended clock页替换算法

1. 现有的框架支持实现该算法，因为页表项中有访问和脏位，实现该算法相对（相对fifo）复杂，需要将swap_out_victim中直接替换链表尾部的页改为从当前链表指针开始遍历，遍历过的页按照一定规则（优先修改脏位，若脏位为0则修改访问位）将部分标志位置0，直至找到标志位（访问位|脏位）为00的页。

1. 对于swappable部分需要在当前链表指针后插入一页，并将该页置为当前指针。

1. 标志位应当在访问的时候作出相应的修改